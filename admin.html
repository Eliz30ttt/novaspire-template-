<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NovaBank Admin Panel</title>

<style>
/* --- Body & Fonts --- */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin:0;
  background:#f5f7fa;
}

/* --- Header --- */
.header {
  background:#0a2f5a;
  color:white;
  padding:20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.header h1 { margin:0; font-size:1.8rem; }

/* --- Container & Cards --- */
.container { padding:20px; }
.card {
  background:white;
  border-radius:15px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 8px 24px rgba(0,0,0,0.08);
}

/* --- Table Styles --- */
.table { width:100%; border-collapse: collapse; }
.table th, .table td { text-align:left; padding:12px; }
.table th {
  background:#0a2f5a;
  color:white;
  border-radius:8px;
}
.table tr:nth-child(even){ background:#f3f4f6; }

/* --- Buttons --- */
.button {
  padding:8px 12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
  transition:0.3s;
}
.button.delete { background:#dc2626; color:white; }
.button.reset { background:#2563eb; color:white; }
.button:hover { opacity:0.85; }

/* --- Total Funds --- */
.total-funds {
  font-size:1.2rem;
  font-weight:bold;
  color:#0a2f5a;
  margin-top:10px;
}

/* --- Responsive --- */
@media (max-width: 600px){
  .table th, .table td { padding:8px; font-size:0.9rem; }
}
</style>
</head>
<body>

<div class="header">
  <h1>NovaBank Admin Panel</h1>
  <button id="logoutBtn" class="button reset">Logout</button>
</div>

<div class="container">
  <div class="card">
    <h2>All Users</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Email</th>
          <th>Balance</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="users"></tbody>
    </table>
    <div class="total-funds" id="totalFunds">Total Bank Funds: $0.00</div>
  </div>
</div>

<script type="module">
import { db, auth, signOut } from "./js/firebase.js";
import { collection, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const usersContainer = document.getElementById("users");
const totalFundsEl = document.getElementById("totalFunds");
const logoutBtn = document.getElementById("logoutBtn");

async function loadUsers(){
  usersContainer.innerHTML="";
  let total=0;
  const querySnap = await getDocs(collection(db,"users"));
  querySnap.forEach(userDoc=>{
    const data=userDoc.data();
    total += data.balance;
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${data.email}</td>
      <td>$${data.balance.toFixed(2)}</td>
      <td>
        <button class="button delete" onclick="deleteUser('${userDoc.id}')">Delete</button>
        <button class="button reset" onclick="resetBalance('${userDoc.id}')">Reset $</button>
      </td>
    `;
    usersContainer.appendChild(row);
  });
  totalFundsEl.innerText = "Total Bank Funds: $" + total.toFixed(2);
}

window.deleteUser = async function(uid){
  if(confirm("Delete this user?")){
    await deleteDoc(doc(db,"users",uid));
    loadUsers();
  }
}

window.resetBalance = async function(uid){
  if(confirm("Reset this user's balance to $0?")){
    await updateDoc(doc(db,"users",uid),{balance:0,transactions:[]});
    loadUsers();
  }
}

logoutBtn.addEventListener("click", async ()=>{
  await signOut(auth);
  window.location.href="login.html";
});

loadUsers();
</script>

</body>
</html>
